package com.qulei.examples.util;

import java.util.Timer;
import java.util.TimerTask;
import java.util.concurrent.CompletableFuture;

public class TimedEventSupport {
	private static final Timer timer = new Timer();

	/**
	 * Build a future to return the value after a delay.
	 * 
	 * @param delay
	 * @param value
	 * @return future
	 */
	public static <T> CompletableFuture<T> delayedSuccess(int delay, T value) {

		System.out.println("-------------->start delay " + value);
		CompletableFuture<T> future = new CompletableFuture<T>();
		TimerTask task = new TimerTask() {
			public void run() {
				future.complete(value);
			}
		};
		timer.schedule(task, delay * 1000);
		return future;
	}

	/**
	 * Build a future to return a throwable after a delay.
	 * 
	 * @param delay
	 * @param t
	 * @return future
	 */
	public static <T> CompletableFuture<T> delayedFailure(int delay, Throwable t) {
		CompletableFuture<T> future = new CompletableFuture<T>();
		TimerTask task = new TimerTask() {
			public void run() {
				future.completeExceptionally(t);
			}
		};
		timer.schedule(task, delay * 1000);
		return future;
	}
}